<div>
  <mat-toolbar class="bg-black" style="padding:10px 50px">
    <!-- Menú hamburguesa -->
    <button mat-icon-button [matMenuTriggerFor]="menuMain">
      <mat-icon>menu</mat-icon>
    </button>

    <!-- Título -->
    <a routerLink="/" class="text-green-500 text-xl font-bold">Observer</a>
    <div class="w-full"></div>

    <!-- Si está logueado -->
    @if (isLoggedIn()) {
      <div *ngIf="authService.getUserDetail() as userDetail">
        <div class="flex gap-5 items-center">
          
          <!-- Ícono del carrito SOLO si está logueado -->
          <a routerLink="/carrito" class="text-green-500 hover:text-green-400">
            <button mat-icon-button>
              <mat-icon>shopping_cart</mat-icon>
            </button>
          </a>

          <!-- Avatar y nombre -->
          <a [matMenuTriggerFor]="menu" class="flex gap-2 cursor-pointer items-center">
            <div class="bg-green-400 text-black font-bold shadow-md rounded-full w-10 h-10 flex justify-center items-center">
              {{ userDetail.fullName[0].toUpperCase() }}
            </div>
            <div class="text-white flex flex-col">
              <h1 class="p-0 m-0 font-medium text-green-500">{{ userDetail.fullName }}</h1>
              <p class="p-0 m-0 font-medium text-xs text-green-500">{{ userDetail.roles }}</p>
            </div>
          </a>

          <!-- Menú usuario -->
          <mat-menu #menu="matMenu">
            <button [routerLink]="['account', 1]" mat-menu-item>
              <mat-icon>account_circle</mat-icon>
              <span>View Profile</span>
            </button>
            <button [routerLink]="['change-password']" mat-menu-item>
              <mat-icon>password</mat-icon>
              <span>Change Password</span>
            </button>
            <button (click)="logout()" mat-menu-item>
              <mat-icon>logout</mat-icon>
              <span>Logout</span>
            </button>
          </mat-menu>
        </div>
      </div>
    } @else {
      <!-- Si NO está logueado -->
      <div class="flex gap-5 items-center">
        <a mat-button routerLink="/about-us" class="text-green-500 hover:underline">
          <span class="text-green-500">Sobre Nosotros</span>
        </a>
        <a mat-button routerLink="/login" class="text-green-500 hover:underline">
          <span class="text-green-500">Login</span>
        </a>
        <span class="text-green-500">|</span>
        <a mat-button routerLink="/register" class="text-green-500 hover:underline">
          <span class="text-green-500">Register</span>
        </a>
      </div>
    }

    <!-- Menú hamburguesa principal -->
    <mat-menu #menuMain="matMenu">
    <!-- Si es Admin -->
    <ng-container *ngIf="authService.getUserDetail()?.roles.includes('Admin'); else checkLogin">
      <button mat-menu-item routerLink="/">
          <mat-icon>home</mat-icon>
          <span>Inicio</span>
        </button>
        <button mat-menu-item routerLink="/documentation">
          <mat-icon>description</mat-icon>
          <span>Documentacion</span>
        </button>
      <button mat-menu-item routerLink="/roles">
        <mat-icon>settings</mat-icon>
        <span>Roles</span>
      </button>
      <button mat-menu-item routerLink="/users">
        <mat-icon>groups</mat-icon>
        <span>Usuarios</span>
      </button>
      <button mat-menu-item routerLink="/proveedores">
        <mat-icon>people</mat-icon>
        <span>Proveedores</span>
      </button>
      <button mat-menu-item routerLink="/compra-proveedor-page">
        <mat-icon>store_mall_directory</mat-icon>
        <span>Compras</span>
      </button>
        <button mat-menu-item routerLink="/cotizaciones">
          <mat-icon>shop_two</mat-icon>
          <span>Cotizaciones</span>
        </button>
      <button mat-menu-item routerLink="/his-transacciones">
        <mat-icon>local_atm</mat-icon>
        <span>Transacciones</span>
      </button>
      <button mat-menu-item routerLink="/his-compras">
        <mat-icon>attach_money</mat-icon>
        <span>Compras</span>
      </button>
      <button mat-menu-item routerLink="/comments">
        <mat-icon>rate_review</mat-icon>
        <span>Comentarios</span>
      </button>
    </ng-container>

    <!-- Verificar si está logueado -->
    <ng-template #checkLogin>
      <ng-container *ngIf="authService.getUserDetail(); else guestMenu">
        <!-- Si está logueado pero no es admin -->
        <button mat-menu-item routerLink="/">
          <mat-icon>home</mat-icon>
          <span>Inicio</span>
        </button>
        <button mat-menu-item routerLink="/formulario">
          <mat-icon>shop_two</mat-icon>
          <span>Cotizacion</span>
        </button>
        <button mat-menu-item routerLink="/documentation">
          <mat-icon>description</mat-icon>
          <span>Documentacion</span>
        </button>
        <button mat-menu-item routerLink="/cotizaciones">
          <mat-icon>shop_two</mat-icon>
          <span>Cotizaciones</span>
        </button>
        <button mat-menu-item routerLink="/his-compras">
          <mat-icon>attach_money</mat-icon>
          <span>Compras</span>
        </button>
        <button mat-menu-item routerLink="/questions">
          <mat-icon>help</mat-icon>
          <span>Ayuda</span>
        </button>
      </ng-container>
    </ng-template>

    <!-- Si NO está logueado -->
    <ng-template #guestMenu>
      <button mat-menu-item routerLink="/login">
        <mat-icon>login</mat-icon>
        <span>Iniciar Sesión</span>
      </button>
      <button mat-menu-item routerLink="/register">
        <mat-icon>person_add</mat-icon>
        <span>Registrarse</span>
      </button>
      <button mat-menu-item routerLink="/questions">
        <mat-icon>help_outline</mat-icon>
        <span>Ayuda</span>
      </button>
    </ng-template>
  </mat-menu>
  </mat-toolbar>
</div>